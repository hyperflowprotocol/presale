<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperFlow Protocol - Universal Wallet Connection</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .calculator-container {
            background: rgba(45, 212, 191, 0.1);
            border: 1px solid #2dd4bf;
            border-radius: 12px;
            padding: 25px;
            margin: 30px auto;
            max-width: 500px;
        }
        
        .calculator-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .calculator-input {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
            color: #e2e8f0;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        
        .purchase-btn {
            background: linear-gradient(135deg, #2dd4bf, #14b8a6);
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
        }
        
        .purchase-btn:hover {
            transform: translateY(-2px);
        }
        
        .purchase-btn:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
        }
        
        .wallet-info {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
        }
    </style>
    
    <!-- Privy SDK - Universal Wallet Connection -->
    <script src="https://unpkg.com/@privy-io/js-sdk@1.0.0/dist/index.js"></script>
    <script src="https://unpkg.com/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header style="background: #1e293b; padding: 20px; border-bottom: 1px solid #334155;">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center;">
                <svg width="40" height="40" viewBox="0 0 100 100" style="margin-right: 12px;">
                    <defs>
                        <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#2dd4bf"/>
                            <stop offset="100%" style="stop-color:#14b8a6"/>
                        </linearGradient>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="url(#logoGrad)"/>
                    <text x="50" y="58" text-anchor="middle" fill="white" font-family="Inter" font-weight="700" font-size="32">HF</text>
                </svg>
                <div>
                    <h1 style="margin: 0; color: #2dd4bf; font-size: 24px; font-weight: 700;">HyperFlow</h1>
                    <p style="margin: 0; color: #94a3b8; font-size: 14px;">Advanced DeFi Protocol</p>
                </div>
            </div>
            
            <button id="connectWalletBtn" onclick="connectUniversalWallet()" style="background: linear-gradient(135deg, #2dd4bf, #14b8a6); border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; font-size: 16px;">
                Connect Wallet
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 80px 20px; text-align: center;">
        <div style="max-width: 800px; margin: 0 auto;">
            <h1 style="font-size: 48px; font-weight: 800; color: #2dd4bf; margin-bottom: 20px;">
                HyperFlow Protocol
            </h1>
            <h2 style="font-size: 32px; font-weight: 600; color: #e2e8f0; margin-bottom: 25px;">
                Universal Wallet Connection
            </h2>
            <p style="font-size: 20px; color: #94a3b8; margin-bottom: 40px;">
                Works on Safari iOS, Chrome, Firefox, Brave - All wallets supported via Privy
            </p>
            
            <!-- Price Info -->
            <div style="background: rgba(45, 212, 191, 0.1); border: 1px solid #2dd4bf; border-radius: 12px; padding: 30px; margin: 40px auto; max-width: 600px;">
                <h3 style="color: #2dd4bf; font-size: 28px; margin-bottom: 20px;">$0.0005</h3>
                <p style="font-size: 18px; margin-bottom: 10px;">Price per FLOW Token</p>
                <p style="font-size: 16px; color: #94a3b8;">25,000 FLOW per 1 HYPE â€¢ 2,000 HYPE Hard Cap</p>
            </div>
        </div>
    </section>

    <!-- Presale Calculator -->
    <section style="padding: 60px 20px; background: #0f172a;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h2 style="text-align: center; font-size: 36px; color: #2dd4bf; margin-bottom: 40px;">
                Presale Calculator
            </h2>
            
            <div class="calculator-container">
                <div class="calculator-row">
                    <span>HYPE Amount:</span>
                    <span id="hypeAmount">0</span>
                </div>
                <input type="number" id="purchaseAmount" class="calculator-input" placeholder="Enter HYPE amount (max 2,000)" min="0" max="2000" oninput="updateCalculation()">
                
                <div class="calculator-row">
                    <span>FLOW Tokens Received:</span>
                    <span id="flowAmount">0</span>
                </div>
                
                <div class="calculator-row">
                    <span>USD Value:</span>
                    <span id="usdValue">$0.00</span>
                </div>
                
                <button id="purchaseBtn" class="purchase-btn" onclick="purchaseTokens()" disabled>
                    Enter Purchase Amount
                </button>
            </div>
        </div>
    </section>

    <script>
        // Global variables
        let walletConnected = false;
        let currentWalletAddress = null;
        let privyClient = null;
        let connectedWallets = [];

        // Initialize Privy Universal Wallet Connection
        async function initializePrivy() {
            try {
                console.log('Initializing Privy Universal Wallet Connection...');
                
                // Initialize Privy with your App ID and universal wallet support
                privyClient = window.Privy.createClient({
                    appId: 'cmebbx3i201jwif0bhy9kxh32',
                    config: {
                        appearance: { theme: 'dark' },
                        embeddedWallets: { createOnLogin: false },
                        defaultChain: { id: 999, name: 'HyperEVM' }, // HyperEVM Chain
                        walletConnect: {
                            // For full cross-browser support, you'd add WalletConnect Project ID here
                            // For now, using fallback that works with most wallets
                            enabled: true
                        },
                        supportedChains: [
                            { id: 999, name: 'HyperEVM', nativeCurrency: { name: 'HYPE', symbol: 'HYPE', decimals: 18 } },
                            { id: 1, name: 'Ethereum', nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 } }
                        ]
                    }
                });

                console.log('Privy client initialized successfully');
                
                // Check if user is already authenticated
                if (privyClient.authenticated) {
                    console.log('User already authenticated, connecting wallets...');
                    await handleExistingConnection();
                }
                
                return true;
            } catch (error) {
                console.error('Privy initialization failed:', error);
                return false;
            }
        }

        // Universal wallet connection that works everywhere
        async function connectUniversalWallet() {
            console.log('=== UNIVERSAL WALLET CONNECTION VIA PRIVY ===');
            console.log('Browser:', navigator.userAgent);
            console.log('Mobile:', isMobileDevice());
            
            if (!privyClient) {
                console.log('Privy not initialized, initializing now...');
                const initialized = await initializePrivy();
                if (!initialized) {
                    alert('Wallet connection service unavailable. Please refresh the page.');
                    return;
                }
            }

            try {
                document.getElementById('connectWalletBtn').disabled = true;
                document.getElementById('connectWalletBtn').textContent = 'Connecting...';

                // Use Privy's universal login with wallet-first approach
                await privyClient.login({
                    methods: ['wallet', 'walletconnect'],
                    walletList: ['metamask', 'coinbase', 'trust', 'rainbow', 'zerion', 'okx', 'walletconnect'],
                    showWalletLoginFirst: true,
                    disableSignup: false
                });

                console.log('Privy login successful');
                await handleSuccessfulPrivyConnection();

            } catch (error) {
                console.error('Universal wallet connection failed:', error);
                handleConnectionError(error);
            }
        }

        // Handle successful Privy connection
        async function handleSuccessfulPrivyConnection() {
            try {
                // Get connected wallets from Privy
                const wallets = await privyClient.getWallets();
                console.log('Connected wallets:', wallets);

                if (wallets && wallets.length > 0) {
                    connectedWallets = wallets;
                    const primaryWallet = wallets[0];
                    
                    await handleSuccessfulConnection(
                        primaryWallet.address, 
                        `${primaryWallet.walletClientType || 'Wallet'} via Privy`
                    );
                } else {
                    throw new Error('No wallets connected through Privy');
                }
            } catch (error) {
                console.error('Failed to get wallet info from Privy:', error);
                handleConnectionError(error);
            }
        }

        // Handle existing connection on page load
        async function handleExistingConnection() {
            try {
                const wallets = await privyClient.getWallets();
                if (wallets && wallets.length > 0) {
                    console.log('Restoring existing wallet connection...');
                    await handleSuccessfulPrivyConnection();
                }
            } catch (error) {
                console.log('No existing connection to restore:', error);
            }
        }

        // Handle successful wallet connection
        async function handleSuccessfulConnection(address, source) {
            walletConnected = true;
            currentWalletAddress = address;
            
            console.log(`Wallet connected: ${address} via ${source}`);

            // Update UI
            document.getElementById('connectWalletBtn').textContent = 'Wallet Connected';
            document.getElementById('connectWalletBtn').style.background = '#22c55e';
            document.getElementById('connectWalletBtn').disabled = true;
            
            // Show wallet info
            const walletInfo = document.createElement('div');
            walletInfo.id = 'walletInfo';
            walletInfo.className = 'wallet-info';
            walletInfo.innerHTML = `
                <div><strong>Connected via ${source}:</strong></div>
                <div style="margin: 5px 0; font-family: monospace;">${address}</div>
                <div style="margin-top: 10px;">
                    <button onclick="disconnectWallet()" style="background: #dc2626; border: none; padding: 8px 16px; border-radius: 6px; color: white; cursor: pointer;">
                        Disconnect
                    </button>
                </div>
            `;
            
            // Add to header
            document.querySelector('header > div').appendChild(walletInfo);
            
            updateCalculation();
        }

        // Handle connection errors
        function handleConnectionError(error) {
            console.error('Connection error:', error);
            
            document.getElementById('connectWalletBtn').textContent = 'Connect Wallet';
            document.getElementById('connectWalletBtn').disabled = false;
            
            let errorMessage = 'Failed to connect wallet';
            if (error.code === 4001) {
                errorMessage = 'Connection rejected by user';
            } else if (error.message) {
                errorMessage = error.message;
            }
            
            alert(errorMessage);
        }

        // Disconnect wallet
        async function disconnectWallet() {
            try {
                if (privyClient && privyClient.authenticated) {
                    await privyClient.logout();
                }
            } catch (error) {
                console.error('Logout error:', error);
            }

            walletConnected = false;
            currentWalletAddress = null;
            connectedWallets = [];
            
            document.getElementById('connectWalletBtn').textContent = 'Connect Wallet';
            document.getElementById('connectWalletBtn').style.background = 'linear-gradient(135deg, #2dd4bf, #14b8a6)';
            document.getElementById('connectWalletBtn').disabled = false;
            
            const walletInfo = document.getElementById('walletInfo');
            if (walletInfo) {
                walletInfo.remove();
            }
            
            updateCalculation();
            console.log('Wallet disconnected');
        }

        // Utility functions
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        function updateCalculation() {
            const amount = parseFloat(document.getElementById('purchaseAmount').value) || 0;
            const flowTokens = amount * 25000;
            const usdValue = amount * 12.5; // $0.0005 * 25000 = $12.5 per HYPE
            
            document.getElementById('hypeAmount').textContent = amount.toLocaleString();
            document.getElementById('flowAmount').textContent = flowTokens.toLocaleString();
            document.getElementById('usdValue').textContent = '$' + usdValue.toFixed(2);
            
            const purchaseBtn = document.getElementById('purchaseBtn');
            if (amount > 0 && amount <= 2000 && walletConnected) {
                purchaseBtn.disabled = false;
                purchaseBtn.textContent = `Purchase ${amount} HYPE for ${flowTokens.toLocaleString()} FLOW`;
            } else if (!walletConnected) {
                purchaseBtn.disabled = true;
                purchaseBtn.textContent = 'Connect Wallet to Purchase';
            } else {
                purchaseBtn.disabled = true;
                purchaseBtn.textContent = 'Enter Purchase Amount';
            }
        }

        async function purchaseTokens() {
            if (!walletConnected) {
                alert('Please connect your wallet first');
                return;
            }
            
            const amount = parseFloat(document.getElementById('purchaseAmount').value);
            if (!amount || amount <= 0) {
                alert('Please enter a valid purchase amount');
                return;
            }
            
            if (amount > 2000) {
                alert('Maximum purchase amount is 2000 HYPE tokens');
                return;
            }
            
            try {
                console.log(`Processing purchase of ${amount} HYPE tokens for ${currentWalletAddress}`);
                
                // Simulate transaction
                alert(`Purchase initiated!\n\nAmount: ${amount} HYPE tokens\nFLOW Received: ${(amount * 25000).toLocaleString()}\nTotal: $${(amount * 12.5).toFixed(2)}\n\nTransaction will be processed on HyperEVM network.`);
                
            } catch (error) {
                console.error('Purchase failed:', error);
                alert('Purchase failed: ' + error.message);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('HyperFlow Universal Wallet Connection Loading...');
            console.log('Your Privy App ID: cmebbx3i201jwif0bhy9kxh32');
            
            // Initialize Privy
            await initializePrivy();
            
            console.log('Ready for universal wallet connections across all browsers and devices');
        });
    </script>
</body>
</html>