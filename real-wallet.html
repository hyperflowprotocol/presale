<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperFlow Protocol - Real Wallet Connection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            color: #2dd4bf;
        }
        
        .status {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }
        
        .status.success { background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }
        .status.error { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }
        .status.info { background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; }
        
        .connect-btn {
            background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 100%);
            color: #0f172a;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(45, 212, 191, 0.3);
        }
        
        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .wallet-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .address {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            word-break: break-all;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .disconnect-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .debug-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🦊 Real Wallet Connection</h1>
        
        <div id="status" class="status info">
            Initializing wallet connection...
        </div>
        
        <button id="connectBtn" class="connect-btn" onclick="connectWallet()">
            Connect Real Wallet
        </button>
        
        <div id="walletInfo" class="wallet-info" style="display: none;">
            <h3>✅ Wallet Connected</h3>
            <div class="address" id="userAddress"></div>
            <div id="chainInfo"></div>
            <div id="balanceInfo"></div>
            <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
        </div>
        
        <div class="debug-info">
            <strong>Browser:</strong> <span id="browserInfo"></span><br>
            <strong>Device:</strong> <span id="deviceInfo"></span><br>
            <strong>Ethereum Provider:</strong> <span id="ethereumInfo"></span><br>
            <strong>Network:</strong> <span id="networkInfo">Not connected</span>
        </div>
    </div>

    <!-- Web3Modal & WalletConnect -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
    <script src="https://unpkg.com/web3@1.10.0/dist/web3.min.js"></script>

    <script>
        let web3Modal;
        let provider;
        let web3;
        let selectedAccount;
        
        // Initialize Web3Modal with real providers
        function initWeb3Modal() {
            const providerOptions = {
                walletconnect: {
                    package: WalletConnectProvider,
                    options: {
                        infuraId: "460f40a260564ac4a4f4b3fffb032dad", // Public Infura ID
                        rpc: {
                            1: "https://mainnet.infura.io/v3/460f40a260564ac4a4f4b3fffb032dad",
                            999: "https://rpc.hyperliquid.xyz/evm", // HyperEVM
                            137: "https://polygon-rpc.com"
                        }
                    }
                }
            };
            
            web3Modal = new Web3Modal({
                network: "mainnet",
                cacheProvider: true,
                providerOptions,
                theme: "dark"
            });
        }
        
        async function connectWallet() {
            try {
                updateStatus("Connecting to wallet...", "info");
                document.getElementById('connectBtn').disabled = true;
                
                // Clear any cached provider first
                if (web3Modal.cachedProvider) {
                    web3Modal.clearCachedProvider();
                }
                
                // Connect to wallet
                provider = await web3Modal.connect();
                web3 = new Web3(provider);
                
                // Get accounts
                const accounts = await web3.eth.getAccounts();
                selectedAccount = accounts[0];
                
                if (!selectedAccount) {
                    throw new Error("No accounts found");
                }
                
                // Get network info
                const chainId = await web3.eth.getChainId();
                const balance = await web3.eth.getBalance(selectedAccount);
                const balanceInEth = web3.utils.fromWei(balance, 'ether');
                
                // Update UI
                updateStatus("Wallet connected successfully!", "success");
                document.getElementById('userAddress').textContent = selectedAccount;
                document.getElementById('chainInfo').innerHTML = `<strong>Chain ID:</strong> ${chainId}`;
                document.getElementById('balanceInfo').innerHTML = `<strong>Balance:</strong> ${parseFloat(balanceInEth).toFixed(4)} ETH`;
                document.getElementById('networkInfo').textContent = getNetworkName(chainId);
                
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('connectBtn').textContent = 'Wallet Connected';
                
                // Setup event listeners
                setupProviderEvents();
                
                console.log("✅ Wallet connected:", selectedAccount);
                console.log("⛓️ Chain ID:", chainId);
                console.log("💰 Balance:", balanceInEth, "ETH");
                
            } catch (error) {
                console.error("❌ Connection failed:", error);
                updateStatus(`Connection failed: ${error.message}`, "error");
                document.getElementById('connectBtn').disabled = false;
            }
        }
        
        function setupProviderEvents() {
            if (provider.on) {
                provider.on("accountsChanged", (accounts) => {
                    console.log("🔄 Account changed:", accounts[0]);
                    if (accounts.length === 0) {
                        disconnectWallet();
                    } else {
                        selectedAccount = accounts[0];
                        document.getElementById('userAddress').textContent = selectedAccount;
                    }
                });
                
                provider.on("chainChanged", (chainId) => {
                    const chainIdNum = parseInt(chainId, 16);
                    console.log("🔗 Chain changed:", chainIdNum);
                    document.getElementById('chainInfo').innerHTML = `<strong>Chain ID:</strong> ${chainIdNum}`;
                    document.getElementById('networkInfo').textContent = getNetworkName(chainIdNum);
                });
                
                provider.on("disconnect", (code, reason) => {
                    console.log("🚪 Provider disconnected:", code, reason);
                    disconnectWallet();
                });
            }
        }
        
        async function disconnectWallet() {
            if (provider && provider.disconnect) {
                await provider.disconnect();
            }
            
            web3Modal.clearCachedProvider();
            
            selectedAccount = null;
            provider = null;
            web3 = null;
            
            document.getElementById('walletInfo').style.display = 'none';
            document.getElementById('connectBtn').textContent = 'Connect Real Wallet';
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('networkInfo').textContent = 'Not connected';
            
            updateStatus("Wallet disconnected", "info");
            console.log("🚪 Wallet disconnected");
        }
        
        function getNetworkName(chainId) {
            const networks = {
                1: "Ethereum Mainnet",
                999: "HyperEVM",
                137: "Polygon",
                56: "BSC",
                42161: "Arbitrum"
            };
            return networks[chainId] || `Unknown (${chainId})`;
        }
        
        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function updateDebugInfo() {
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            let browser = 'Unknown';
            if (userAgent.includes('Chrome')) browser = 'Chrome';
            else if (userAgent.includes('Firefox')) browser = 'Firefox';
            else if (userAgent.includes('Safari')) browser = 'Safari';
            else if (userAgent.includes('Edge')) browser = 'Edge';
            
            document.getElementById('browserInfo').textContent = browser;
            document.getElementById('deviceInfo').textContent = isMobile ? 'Mobile' : 'Desktop';
            document.getElementById('ethereumInfo').textContent = window.ethereum ? 'Available' : 'Not Available';
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateDebugInfo();
            initWeb3Modal();
            updateStatus("Ready to connect real wallet", "info");
            
            // Auto-reconnect if previously connected
            if (web3Modal.cachedProvider) {
                connectWallet();
            }
        });
    </script>
</body>
</html>